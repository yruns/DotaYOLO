# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# YOLO11 + Swin Transformer Stage OBB æ¨¡å‹
# ä½¿ç”¨ PatchEmbed, SwinStage, PatchMerging ä½œä¸º backbone
# å‚è€ƒ https://github.com/YJHCUI/SwinTransformer-YOLOv5/

# Parameters
nc: 15  # DOTA dataset classes

# Swin Transformer backbone
# ä½¿ç”¨åˆ†å±‚çš„ Swin Transformer ç»“æ„
# è¾“å…¥: [B, 3, 640, 640]
backbone:
  # [from, repeats, module, args]
  # PatchEmbed: [c2, patch_size] - å°†å›¾åƒåˆ†å‰²æˆ patch å¹¶åµŒå…¥
  # SwinStage: [c2, depth, num_heads, window_size] - Swin Transformer å±‚
  # PatchMerging: [c2] - ä¸‹é‡‡æ ·å¹¶å¢åŠ é€šé“æ•°
  
  - [-1, 1, PatchEmbed, [96, 4]]       # 0: [B, 96, 160, 160] P2/4
  - [-1, 1, SwinStage, [96, 2, 3, 7]]  # 1: [B, 96, 160, 160] Stage1
  - [-1, 1, PatchMerging, [192]]       # 2: [B, 192, 80, 80] P3/8
  - [-1, 1, SwinStage, [192, 2, 6, 7]] # 3: [B, 192, 80, 80] Stage2 --F0--
  - [-1, 1, PatchMerging, [384]]       # 4: [B, 384, 40, 40] P4/16
  - [-1, 1, SwinStage, [384, 6, 12, 7]] # 5: [B, 384, 40, 40] Stage3 --F1--
  - [-1, 1, PatchMerging, [768]]       # 6: [B, 768, 20, 20] P5/32
  - [-1, 1, SwinStage, [768, 2, 24, 7]] # 7: [B, 768, 20, 20] Stage4 --F2--
  - [-1, 1, SPPF, [768, 5]]            # 8: SPPF

# YOLO11 Head (FPN-PAN ç»“æ„)
# å¤šå°ºåº¦ç‰¹å¾æ¥è‡ª:
#   - F0 (layer 3): 192 é€šé“, 1/8 ä¸‹é‡‡æ ·
#   - F1 (layer 5): 384 é€šé“, 1/16 ä¸‹é‡‡æ ·
#   - F2 (layer 8): 768 é€šé“ (ç»è¿‡SPPF), 1/32 ä¸‹é‡‡æ ·
head:
  # Top-down path (FPN)
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]  # 9: upsample
  - [[-1, 5], 1, Concat, [1]]                    # 10: concat F1
  - [-1, 2, C3k2, [384, False]]                  # 11: P4 ç‰¹å¾

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]  # 12: upsample
  - [[-1, 3], 1, Concat, [1]]                    # 13: concat F0
  - [-1, 2, C3k2, [192, False]]                  # 14: P3/8-small

  # Bottom-up path (PAN)
  - [-1, 1, Conv, [192, 3, 2]]                   # 15: downsample
  - [[-1, 11], 1, Concat, [1]]                   # 16: concat P4
  - [-1, 2, C3k2, [384, False]]                  # 17: P4/16-medium

  - [-1, 1, Conv, [384, 3, 2]]                   # 18: downsample
  - [[-1, 8], 1, Concat, [1]]                    # 19: concat P5
  - [-1, 2, C3k2, [768, True]]                   # 20: P5/32-large

  # OBB Detection head
  - [[14, 17, 20], 1, OBB, [nc, 1]]              # 21: OBB Detect (P3, P4, P5)

